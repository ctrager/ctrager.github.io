<!DOCTYPE html>
<html>

<head>
    <meta name="Description" content="Video motion detection written by Corey Trager in HTML and Javascript">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Motion Detector</title>
    <style>
        canvas {border: 1px solid red;}
        video {border: 1px solid blue;}
        image {border: 1px solid orange;}
    </style>
    <script>
        var first_time = true
        var ready = false
        var video_stream
        var canvas_el
        var video_el
        var image_el
        var content_div
        var ctx
        var config = {
            width: 300,
            height: 200
        }


        function init_web_audio() {

            navigator.mediaDevices.getUserMedia({
                    audio: false,
                    video: { width: config.width, height: config.height }
                })
                .then(function (stream) {
                    video_stream = stream
                    video_el.srcObject = stream
                    ready = true
                    console.log("ready")
                })
                .catch(function (err) {
                    console.log(err)
                })
        }

        function on_load() {
            console.log("on load")
  
            video_el = document.createElement("video")
            video_el.width = config.width
            video_el.height = config.height
            video_el.autoplay = true

            canvas_el = document.createElement("canvas")
            canvas_el.width = config.width
            canvas_el.height = config.height

            image_el = document.createElement('img')
            image_el.width = config.width
            image_el.height = config.height

            document.getElementById("video_div").appendChild(video_el)
            document.getElementById("canvas_div").appendChild(canvas_el)
            document.getElementById("image_div").appendChild(image_el)

            ctx = canvas_el.getContext("2d");
        }

        function on_start() {
            if (first_time) {
                first_time = false
                init_web_audio()
            }
        }

        function on_snapshot() {
            ctx.drawImage(video_el, 0, 0);
            image_el.src = canvas_el.toDataURL('image/webp');
        }
    </script>
</head>

<body onload="on_load()">
    <button onclick="on_start()">start</button>
    <button onclick="on_snapshot()">snapshot</button>
    <div id="video_div"></div>
    <div id="canvas_div"></div>
    <div id="image_div"></div>
    <!-- 
    <br>
    <video id="my_video" width="300" height="200" autoplay></video>
    <br>
    <canvas id="my_canvas" width="300" height="200"></canvas>
    <br>
    <image id="my_image" width="300" height="200"></image>
    -->
</body>

</html>